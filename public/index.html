<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoLink</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="welcomeSection" class="welcome-section">
        <div class="welcome-content">
            <div class="logo">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 3L2 12H5V20H11V14H13V20H19V12H22L12 3Z" fill="currentColor"/>
                </svg>
            </div>
            <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ EchoLink</h1>
            <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –∫–æ–ª–ª–µ–≥–∞–º–∏</p>
            <div class="welcome-buttons">
                <button class="btn btn-primary" onclick="window.location.href='login.html'">–í–æ–π—Ç–∏</button>
                <button class="btn btn-secondary" onclick="window.location.href='register.html'">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>
    </div>

    <div id="appSection" class="app" style="display: none;">
        <!-- Server sidebar -->
        <div class="server-sidebar">
            <div class="server-icon active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 3L2 12H5V20H11V14H13V20H19V12H22L12 3Z" fill="currentColor"/>
                </svg>
            </div>
        </div>

        <!-- Channel sidebar -->
        <div class="channel-sidebar">
            <div class="server-header">
                <h2>EchoLink Server</h2>
            </div>

            <div class="channels-container">
                <div class="channel-category">TEXT CHANNELS</div>
                <div class="channel"># general</div>
                <div class="channel"># random</div>
                <div class="channel"># announcements</div>

                <div class="channel-category">VOICE CHANNELS</div>
                <div class="channel voice-channel">üîä General Voice</div>
                <div class="channel voice-channel">üîä Music Room</div>
            </div>

            <div class="friends-section">
                <div class="channel-category">–î–†–£–ó–¨–Ø</div>
                <div class="add-friend-btn" onclick="showAddFriendModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</span>
                </div>
                <div id="friends-list">
                    <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- Main chat area -->
        <div class="chat-area">
            <div class="chat-header">
                <span># general</span>
            </div>

            <div class="messages-container">
                <div class="message">
                    <div class="avatar">üë§</div>
                    <div class="message-content">
                        <div class="username">User1</div>
                        <div class="timestamp">Today at 10:30 AM</div>
                        <div class="text">Hello everyone! Welcome to our Discord clone.</div>
                    </div>
                </div>

                <div class="message">
                    <div class="avatar">üë•</div>
                    <div class="message-content">
                        <div class="username">User2</div>
                        <div class="timestamp">Today at 10:32 AM</div>
                        <div class="text">This looks amazing! Great job on the design.</div>
                    </div>
                </div>

                <div class="message">
                    <div class="avatar">üë§</div>
                    <div class="message-content">
                        <div class="username">User1</div>
                        <div class="timestamp">Today at 10:35 AM</div>
                        <div class="text">Thanks! I tried to replicate Discord's UI as closely as possible.</div>
                    </div>
                </div>
            </div>

            <div class="message-input-container">
                <input type="text" class="message-input" placeholder="–ù–∞—á–Ω–∏ –ø–∏—Å–∞—Ç—å...">
            </div>
        </div>

        <!-- User panel -->
        <div class="user-panel">
            <div class="user-info">
                <div class="user-avatar">üë§</div>
                <div class="user-details">
                    <div class="username" id="currentUsername">CurrentUser</div>
                    <div class="user-status" id="currentUserTag">#000000</div>
                </div>
                <div class="user-actions">
                    <button onclick="logout()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z" fill="currentColor"/>
        <path d="M11 7H9V17H11V7Z" fill="currentColor"/>
        <path d="M15 10V14H17V10H15Z" fill="currentColor"/>
    </svg>
</button>
                    <button onclick="window.location.href='settings.html'">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2"/>
        <path d="M19.0001 11.5H17.0001" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M7.00012 11.5H5.00012" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M16.93 7.5L15.5 6.07" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M8.5 17.93L7.07 16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M16.93 16.5L15.5 17.93" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M8.5 6.07L7.07 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
</button>
                </div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞—è–≤–∫–∞—Ö –≤ –¥—Ä—É–∑—å—è -->
        <div id="friendRequestsNotification" class="friend-requests-notification">
            <div class="notification-header">
                <h3>–ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è</h3>
            </div>
            <div class="notification-body">
                <div id="incomingRequestsListSmall">
                    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>
    <div id="addFriendModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</h2>
                <button class="close-modal" onclick="closeAddFriendModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="friendTag">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="friendTag" name="friendTag" placeholder="#000000" maxlength="6">
                </div>
                <button class="send-request-btn" onclick="sendFriendRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
                <div class="error-message" id="friendErrorMessage"></div>
                <div class="success-message" id="friendSuccessMessage"></div>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥—Ä—É–∑—å—è -->
    <div id="friendRequestsPanel" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>–ó–∞–ø—Ä–æ—Å—ã –≤ –¥—Ä—É–∑—å—è</h2>
                <button class="close-modal" onclick="closeFriendRequestsPanel()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="incomingRequestsList">
                    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            const welcomeSection = document.getElementById('welcomeSection');
            const appSection = document.getElementById('appSection');

            if (token) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                fetch('/api/profile', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.username) {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                        welcomeSection.style.display = 'none';
                        appSection.style.display = 'flex';

                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞–≤–∞—Ç–∞—Ä –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä
                        document.getElementById('currentUsername').textContent = data.username;
                        if (data.avatar) {
                            document.querySelector('.user-avatar').textContent = data.avatar;
                        }
                        if (data.user_tag) {
                            document.getElementById('currentUserTag').textContent = '#' + data.user_tag;
                        }
                    } else {
                        // –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, –æ—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        localStorage.removeItem('token');
                        localStorage.removeItem('username');
                        welcomeSection.style.display = 'flex';
                        appSection.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞:', error);
                    // –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    localStorage.removeItem('token');
                    localStorage.removeItem('username');
                    welcomeSection.style.display = 'flex';
                    appSection.style.display = 'none';
                });
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                welcomeSection.style.display = 'flex';
                appSection.style.display = 'none';
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            const confirmed = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è?');
            if (confirmed) {
                localStorage.removeItem('token');
                localStorage.removeItem('username');
                // –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                document.getElementById('welcomeSection').style.display = 'flex';
                document.getElementById('appSection').style.display = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∞
        function showAddFriendModal() {
            document.getElementById('addFriendModal').style.display = 'flex';
            document.getElementById('friendTag').focus();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∞
        function closeAddFriendModal() {
            document.getElementById('addFriendModal').style.display = 'none';
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('friendTag').value = '';
            document.getElementById('friendErrorMessage').style.display = 'none';
            document.getElementById('friendSuccessMessage').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è
        function sendFriendRequest() {
            const friendTag = document.getElementById('friendTag').value.trim();
            const token = localStorage.getItem('token');
            const errorMessage = document.getElementById('friendErrorMessage');
            const successMessage = document.getElementById('friendSuccessMessage');

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–≥ –≤–≤–µ–¥–µ–Ω –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 6 —Ü–∏—Ñ—Ä
            if (!friendTag || friendTag.length !== 6 || !/^\d+$/.test(friendTag)) {
                errorMessage.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π 6-–∑–Ω–∞—á–Ω—ã–π —Ç–µ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
                errorMessage.style.display = 'block';
                return;
            }

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/api/friends/request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({ userTag: friendTag })
            })
            .then(async response => {
                if (response.ok) {
                    return response.json();
                } else {
                    // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ OK, –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
                    const errorText = await response.text();
                    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', errorText);
                    throw new Error(`–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${response.status} - ${errorText}`);
                }
            })
            .then(data => {
                if (data.message) {
                    successMessage.textContent = data.message;
                    successMessage.style.display = 'block';

                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    document.getElementById('friendTag').value = '';

                    // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞—è–≤–∫–∞—Ö –≤ –¥—Ä—É–∑—å—è
                    setTimeout(() => {
                        if (typeof showFriendRequestsNotification === 'function') {
                            showFriendRequestsNotification();
                        }
                    }, 1000);

                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(closeAddFriendModal, 2000);
                } else {
                    errorMessage.textContent = data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞';
                    errorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è:', error);
                errorMessage.textContent = `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ${error.message}`;
                errorMessage.style.display = 'block';
            });
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ –æ–±–ª–∞—Å—Ç–∏
        document.getElementById('addFriendModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAddFriendModal();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏ Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('addFriendModal');
                if (modal.style.display === 'flex') {
                    closeAddFriendModal();
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥—Ä—É–∑—å—è
        function showFriendRequestsPanel() {
            const panel = document.getElementById('friendRequestsPanel');
            panel.style.display = 'flex';

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –¥—Ä—É–∑—å—è
            loadIncomingFriendRequests();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥—Ä—É–∑—å—è
        function closeFriendRequestsPanel() {
            document.getElementById('friendRequestsPanel').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥—Ä—É–∑—å—è
        function loadIncomingFriendRequests() {
            const token = localStorage.getItem('token');
            const requestsList = document.getElementById('incomingRequestsList');

            fetch('/api/friends/requests/incoming', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => response.json())
            .then(requests => {
                // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
                requestsList.innerHTML = '';

                if (requests.length === 0) {
                    requestsList.innerHTML = '<div class="no-requests">–ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</div>';
                    return;
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤ —Å–ø–∏—Å–æ–∫
                requests.forEach(request => {
                    const requestItem = document.createElement('div');
                    requestItem.className = 'request-item';

                    requestItem.innerHTML = `
                        <div class="avatar">${request.avatar || 'üë§'}</div>
                        <div class="user-info">
                            <div class="username">${request.username}</div>
                            <div class="user-tag">#${request.user_tag}</div>
                        </div>
                        <div class="request-actions">
                            <button class="request-action-btn accept" onclick="acceptFriendRequest(${request.id})">‚úì</button>
                            <button class="request-action-btn reject" onclick="rejectFriendRequest(${request.id})">√ó</button>
                        </div>
                    `;

                    requestsList.appendChild(requestItem);
                });
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥—Ä—É–∑—å—è:', error);
                requestsList.innerHTML = '<div class="error-loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤</div>';
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è
        function acceptFriendRequest(requestId) {
            const token = localStorage.getItem('token');

            fetch(`/api/friends/requests/${requestId}/accept`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
                    loadIncomingFriendRequests();
                } else {
                    alert(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–ø—Ä–æ—Å–∞');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è
        function rejectFriendRequest(requestId) {
            const token = localStorage.getItem('token');

            fetch(`/api/friends/requests/${requestId}/reject`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
                    loadIncomingFriendRequests();
                } else {
                    alert(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        }

        // –î–æ–±–∞–≤–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∏–∫–æ–Ω–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞–Ω–µ–ª—å –∑–∞–ø—Ä–æ—Å–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–±–∞–≤–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–∞–Ω–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥—Ä—É–∑—å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∞–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userInfoPanel = document.querySelector('.user-info-panel');
            if (userInfoPanel) {
                userInfoPanel.addEventListener('click', function(event) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –±—ã–ª –Ω–µ –ø–æ –∫–Ω–æ–ø–∫–∞–º –≤—ã—Ö–æ–¥–∞ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    if (!event.target.closest('.user-actions button')) {
                        showFriendRequestsPanel();
                    }
                });
            }
        });
    </script>
    <script src="script.js"></script>
    <style>
        .welcome-section {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #36393F;
            color: white;
        }

        .welcome-content {
            text-align: center;
            max-width: 600px;
            padding: 20px;
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo svg {
            width: 60px;
            height: 60px;
            fill: #ffffff;
        }

        .welcome-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .welcome-content p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #B5BAC1;
        }

        .welcome-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background-color: #5865F2;
            color: white;
            border: none;
        }

        .btn-secondary {
            background-color: transparent;
            color: white;
            border: 1px solid #B5BAC1;
        }

        .friend-requests-notification {
            width: 100%;
            background-color: #2f3136;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            display: block;
        }

        .notification-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #202225;
        }

        .notification-header h3 {
            margin: 0;
            color: white;
            font-size: 16px;
        }

        .notification-body {
            padding: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .request-item-small {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .request-item-small:hover {
            background-color: #36393f;
        }

        .avatar-small {
            font-size: 20px;
            margin-right: 10px;
        }

        .user-info-small {
            flex: 1;
        }

        .username-small {
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .user-tag-small {
            color: #b9bbbe;
            font-size: 12px;
        }

        .request-actions-small {
            display: flex;
            gap: 4px;
        }

        .request-action-btn-small {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .accept-small {
            background-color: #3ba55d;
            color: white;
        }

        .reject-small {
            background-color: #f23f43;
            color: white;
        }

        .no-requests-small {
            text-align: center;
            color: #b9bbbe;
            padding: 20px;
            font-size: 14px;
        }

        .error-loading-small {
            text-align: center;
            color: #f23f43;
            padding: 20px;
            font-size: 14px;
        }
    </style>
</body>
</html>