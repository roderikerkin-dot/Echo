<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Clone</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="authCheck">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...</div>

    <div class="app" style="display: none;">
        <!-- Server sidebar -->
        <div class="server-sidebar">
            <div class="server-icon active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 3L2 12H5V20H11V14H13V20H19V12H22L12 3Z" fill="currentColor"/>
                </svg>
            </div>
        </div>

        <!-- Channel sidebar -->
        <div class="channel-sidebar">
            <div class="server-header">
                <h2>General Server</h2>
            </div>

            <div class="channels-container">
                <div class="channel-category">TEXT CHANNELS</div>
                <div class="channel"># general</div>
                <div class="channel"># random</div>
                <div class="channel"># announcements</div>

                <div class="channel-category">VOICE CHANNELS</div>
                <div class="channel voice-channel">üîä General Voice</div>
                <div class="channel voice-channel">üîä Music Room</div>
            </div>
        </div>

        <!-- Main chat area -->
        <div class="chat-area">
            <div class="chat-header">
                <span># general</span>
            </div>

            <div class="messages-container">
                <div class="message">
                    <div class="avatar">üë§</div>
                    <div class="message-content">
                        <div class="username">User1</div>
                        <div class="timestamp">Today at 10:30 AM</div>
                        <div class="text">Hello everyone! Welcome to our Discord clone.</div>
                    </div>
                </div>

                <div class="message">
                    <div class="avatar">üë•</div>
                    <div class="message-content">
                        <div class="username">User2</div>
                        <div class="timestamp">Today at 10:32 AM</div>
                        <div class="text">This looks amazing! Great job on the design.</div>
                    </div>
                </div>

                <div class="message">
                    <div class="avatar">üë§</div>
                    <div class="message-content">
                        <div class="username">User1</div>
                        <div class="timestamp">Today at 10:35 AM</div>
                        <div class="text">Thanks! I tried to replicate Discord's UI as closely as possible.</div>
                    </div>
                </div>
            </div>

            <div class="message-input-container">
                <input type="text" class="message-input" placeholder="–ù–∞—á–Ω–∏ –ø–∏—Å–∞—Ç—å...">
            </div>
        </div>

        <!-- User panel -->
        <div class="user-panel">
            <div class="user-info">
                <div class="user-avatar">üë§</div>
                <div class="user-details">
                    <div class="username" id="currentUsername">CurrentUser</div>
                    <div class="user-status">#4567</div>
                </div>
                <div class="user-actions">
                    <button onclick="logout()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z" fill="currentColor"/>
        <path d="M11 7H9V17H11V7Z" fill="currentColor"/>
        <path d="M15 10V14H17V10H15Z" fill="currentColor"/>
    </svg>
</button>
                    <button onclick="window.location.href='settings.html'">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2"/>
        <path d="M19.0001 11.5H17.0001" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M7.00012 11.5H5.00012" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M16.93 7.5L15.5 6.07" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M8.5 17.93L7.07 16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M16.93 16.5L15.5 17.93" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M8.5 6.07L7.07 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('token');
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const authCheckDiv = document.getElementById('authCheck');
            const appDiv = document.querySelector('.app');

            if (isLoggedIn === 'true' && token) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞, –∑–∞–ø—Ä–æ—Å–∏–≤ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
                try {
                    const response = await fetch('/api/profile', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    });

                    if (response.ok) {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                        authCheckDiv.style.display = 'none';
                        appDiv.style.display = 'flex';

                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        const userData = await response.json();
                        document.getElementById('currentUsername').textContent = userData.username;

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º CSRF-—Ç–æ–∫–µ–Ω
                        if (userData.csrfToken) {
                            localStorage.setItem('csrfToken', userData.csrfToken);
                        }
                    } else {
                        // –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('username');
                        localStorage.removeItem('token');
                        window.location.href = 'login.html';
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞:', error);
                    // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('username');
                    localStorage.removeItem('token');
                    window.location.href = 'login.html';
                }
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                window.location.href = 'login.html';
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            const confirmed = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è?');
            if (confirmed) {
                // –û—Ç–∑—ã–≤–∞–µ–º —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                const token = localStorage.getItem('token');
                if (token) {
                    fetch('/api/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    })
                    .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error)); // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
                }

                // –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('username');
                localStorage.removeItem('token');

                window.location.href = 'login.html';
            }
        }
    </script>
    <script src="script.js"></script>
</body>
</html>